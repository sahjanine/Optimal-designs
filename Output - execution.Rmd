---
title: "Resultados algoritmo"
author: "Samantha"
date: "2024-09-03"
output:
  prettydoc::html_pretty:
    theme:architect
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r read, echo=FALSE}

sourceDir <- function(path, trace = TRUE, method) {
    for (nm in list.files(path, pattern = "[.][RrSsQq]$")) {
       if(metodo == "bayesian") 
       source(file.path(path, 'optimal designs - Bayesian.R'))
       if(metodo == "locally") 
       source(file.path(path, 'optimal designs - Criterion D.R'))
    }
 }

path_dir<-"C:/Users/OneDrive/Documents/"

method_choose<-"bayesian" 

sourceDir(path=path_dir,method=method_choose)

```


```{r entry, echo=FALSE}
# parameters used for each scenario # 
# m=1, k=1 #
K <- 1
m<-1
beta<-c(2,1)
alfa<-c(1)

# m=1, k=2 #
K <- 2
m<-1
beta<-c(20,3,-1,0.5)
alfa<-c(-0.5,2)

# m=2, k=1 # 
K <- 1
m<-2
beta<-c(-2,0.5,3)
alfa<-c(0.5) 

# m=2, k=2 # 
K <- 2
m<-2
beta<-c(1,1,1,-2,-2,2)
alfa<-c(0.5,0.5)
 
# LEVELS OF EACH FACTOR                          
Levels <- list(1:10,1:10) 


# NUMBER OF RUNS                       
N <- 16

# NUMBER OF 'TRIES' FOR THE EXCHANGE ALGORITHM
Ntries <-  10000


# INDICATORS OF TERMS IN THE SECOND ORDER MODEL
# ENTRIES IN THE ORDER: LINEAR, QUADRATIC, INTERACTIONS  
Terms <- matrix(c(rep(1,K),rep(1,K),rep(1,(K*(K-1)/2))),nr=1) 

Npar <- sum(Terms)

# ALGORITHMS FOR THE SEARCH, CHOOSE ONE FROM THE THREE OPTIONS
# "P" POINT EXCHANGE
# "CR" COORDINATE EXCHANGE BY ROW
# "CC" COORDINATE EXCHANGE BY COLUMN
AlgType <- "CR"
# TO RUN THE SEARCH
set.seed(14)
des <- SearchTreat(K,Levels,Cubic,N,Ntries, m, beta, alfa,
                   Terms,Npar,AlgType)   


# ##P - POINT EXCHANGE
# AlgType <- "P"
# Cubic <- 'Y'
# # TO RUN THE SEARCH
# set.seed(14)
# des <- SearchTreat(K,Levels,Cubic,N,Ntries, m, beta, alfa,
#                    Terms,Npar,AlgType)  


## Bayesian 
K <- 1
m <- 1

# TO RUN THE SEARCH
set.seed(14)
des <- SearchTreat(K,Levels,Cubic,N,Ntries, m, 
                   Terms,Npar,AlgType) 

```
# Functions to draw the designs obtained

```{r tickz1,echo=FALSE}
## Function do draw tickz figure - 1 Factor
generate_tikz_circles<-function(circle_positions, circle_sizes, output_file) {
  tikz(output_file, standAlone = TRUE)
  cat("\\begin{tikzpicture}\n")
  start_x <- min(circle_positions)
  end_x <- max(circle_positions)
  cat("\\draw[black, thick] (", start_x, ",0) -- (", end_x, ",0);\n", sep = "")
  
  for (i in 1:length(circle_positions)) {
    x <- circle_positions[i]
    size <- circle_sizes[i]
    if (!is.na(size)) {
      cat("\\filldraw [blue] (", x, ",0.2) circle (", size, "pt);\n", sep = "")
    }
  }

  cat("\\end{tikzpicture}\n")

  dev.off()
}

```

```{r tickz, echo=FALSE}
## Function do draw tickz figure - 2 Factors
generate_tikz_circles2 <- function(circle_positions, circle_sizes, output_file) {
  tikz(output_file, standAlone = TRUE)
  escala = 1
  end_x = max(circle_positions[, 1])
  end_y = max(circle_positions[, 2])
  
  cat("\\begin{tikzpicture}\n")#, file = arquivo, append = TRUE)
  cat("\\draw[black, thin] (0,0) rectangle (", escala*end_x, ",", escala*end_y, ");\n", sep = "")

  for (i in 1:nrow(circle_positions)) {
    x <- circle_positions[i, 1]
    y <- circle_positions[i, 2]
    size <- circle_sizes[i]
    cat("\\filldraw [blue] (", escala*x, ",", escala*y, ") circle (", size, "pt);\n", sep = "")
  }
  
  cat("\\end{tikzpicture}\n")
  
  dev.off()
}

```

```{r desenho, echo=FALSE}
draw_design<-function(output_file,factors){
  if(is.data.frame(factors)==TRUE){ ##2 factors
    unique_combination <- unique(factors)
    count_combination <- table(apply(factors, 1, paste, collapse = ","))
    contagens <- numeric(nrow(unique_combination))
    
    for (i in 1:nrow(unique_combination)) {
      combination <- paste(unique_combination[i, ], collapse = ",")
      count[i] <- count_combination[combination]
      }
    circle_sizes <- as.vector(count)
    generate_tikz_circles2(unique_combination, circle_sizes, output_file) 

  }
  else{ ## 1 factor
    data<-data.frame(treat= as.factor(factors))
    freq<-table(data$treat)
    positions<-as.vector(as.numeric(names(freq)))
    circle_sizes<-as.numeric(freq)
    generate_tikz_circles(positions, circle_sizes, output_file)
  }
}


```

```{r result, echo=FALSE}
library(tikzDevice)
matrix_X<-des$Xopt_ref
matrix_X<-as.data.frame(matrix_X)


numbers_factors<-function(k, matrix_X){
  if(K==1){
    fat<-matrix_X$V3
  }
  else if(K==2){
    fat<-data.frame(matrix_X$V2,matrix_X$V3)
  }
  return(fat)
}

factors<-numbers_factors(k,matrix_X)


output_file <-"draw_design_test.tex"

image<-draw_design(output_file, factors)
```
# Paste you tickz code here. Example:

```{tikz, fig.ext='png', cache=TRUE}
\begin{tikzpicture}
\draw[black, thin] (0.5,0.5) rectangle (5,5);
\filldraw [blue] (5,0.5) circle (2pt);
\filldraw [blue] (0.5,0.5) circle (2pt);
\filldraw [blue] (0.5,5) circle (2pt);
\filldraw [blue] (3.5,1) circle (1pt);
\filldraw [blue] (5,1) circle (1pt);
\filldraw [blue] (2,5) circle (2pt);
\filldraw [blue] (3.5,0.5) circle (1pt);
\filldraw [blue] (0.5,1.5) circle (1pt);
\filldraw [blue] (5,5) circle (2pt);
\filldraw [blue] (5,1.5) circle (1pt);
\filldraw [blue] (1,1) circle (1pt);
\end{tikzpicture}
```
# Load the figure with the name generated. Example:
```{r, echo=FALSE, fig.align='center', fig.cap="Locally D-optimal design", out.width="70%"}
knitr::include_graphics("figure/unnamed-chunk-1-1.png")
```




